{% extends "layout.html" %}

{% block title %}
    Dashboard - Spotify Stats
{% endblock %}

{% block main %}

<div class="container mt-5 text-center text-white">
    <!-- Profile Picture with Black Stroke Border -->
    <div class="profile-picture-container" style="display: inline-block; position: relative;">
        <img src="{{ user_image }}" alt="Profile Image" class="rounded-circle border border-dark" style="width: 150px; height: 150px; object-fit: cover; object-position: top;">
    </div>

    <h3 class="mt-3">{{ user_name }}</h3>

    <!-- Stats Below Profile Picture -->
    <div class="stats mt-4">
        <p><strong>Total Plays Today:</strong> {{ total_play_today }}</p>
        <p><strong>Total Plays:</strong> {{ total_play_count }}</p>
        <p><strong>Total Minutes:</strong> {{ total_listened_minutes }} minutes</p>
        <p><strong>Total Hours:</strong> {{ total_listened_hours }} hours</p>
    </div>
</div>





    <h2>Your Top Artists</h2>
    {% if top_artist_list %}
        <ul>
            {% for artist in top_artist_list %}
                <li>{{ artist[0] }}</li>  {# artist is a tuple (artist_name, artist_id, artist_popularity), artist[0] extracts the artist name #}
            {% endfor %}
        </ul>
    {% else %}
        <p>No data available. Try logging in with Spotify.</p>
    {% endif %}


    <h2>Your Recently Played Songs</h2>
    {% if track_play_counts %}
        <ul>
        {% for track in track_play_counts %}
            <li>
                <strong>{{ track[0] }} by {{ track[1] }}</strong>  <!-- Track Name (track[0]), Artist Name (track[1]) -->
                <br>
                Played {{ track[2] }} times  <!-- track is a tuple (track_name, artist_name, play_count), track[2] extracts the play count -->
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p>No recent tracks found. Try playing some music on Spotify.</p>
    {% endif %}

    
    <h2>Total Plays Per Day</h2>
    {% if daily_play_counts %}
        <ul>
        {% for play_date, count in daily_play_counts %}
            <li>{{ play_date }}: {{ count }} listens</li>
        {% endfor %}
        </ul>
    {% else %}
        <p>No data available for daily plays.</p>
    {% endif %}


    <h2>Total listen count</h2>
        {% if total_play_count %}   
        <ul>
            <li>{{ total_play_count }}</li>
        </ul>
            {% else %}
                <p>No data available for total plays.</p>
        {% endif %}

    <h2>Top Genres</h2>
    {% if top_genres %}
        <ul>
            {% for genre, count in top_genres %}
                <li>{{ genre }}: {{ count }} listens</li>
            {% endfor %}
        </ul>
    {% else %}
                <p>No data available for top genres.</p>
    {% endif %}

    <h2>Top Tracks</h2>
    {% if top_tracks_list %}
        <ul>
            {% for track_name, artist_name, popularity in top_tracks_list %}  <!-- Track Name, Artist Name, Popularity -->
                <li>{{ track_name }} by {{ artist_name }} ({{ popularity }})</li>
            {% endfor %}
        </ul>
    {% else %}
                <p>No data available for top tracks.</p>
    {% endif %}

    <h2>Total listened time</h2>
    {% if total_listened_minutes or total_listened_hours %}
        <ul>
            <li>{{ total_listened_minutes }} minutes | {{ total_listened_hours }} hours</li>
        </ul>
    {% else %}
        <p>No data available for total listened time.</p>
    {% endif %}    

    <h2>Total listened minutes and hours</h2>
    {% if daily_listening_time %}
        <ul>
            {% for day in daily_listening_time %}
                {% set hours = day[1] // 60 %}
                {% set minutes = day[1] % 60 %}
                <li>{{ day[0] }}: {{ day[1] }} minutes ({{ hours }} hours {{ minutes }} minutes)</li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No data available for total listened time.</p>
    {% endif %}   
{% endblock %}
